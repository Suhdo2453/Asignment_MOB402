<%- include('../inc/header') %>
    <div class="container my-5" style="min-height: 100vh;">
        <h1 style="margin-top: 70px;">Products</h1>
        <hr>
        <button type="button" class="btn btn-primary mb-3" data-toggle="modal" data-target="#addProductModal">
            Add Product
        </button>
        <table class="table table-striped table-bordered" id="productTable">
            <thead>
                <tr>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Category
                        <select id="group-filter" class="form-select-sm float-end">
                            <option value="">All</option>
                            <option value="Loại 1">Loại 1</option>
                            <option value="Loại 2">Loại 2</option>
                        </select>
                    </th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dữ liệu sản phẩm sẽ được load ở đây -->
                <% data.forEach(function(element, index) { %>
                    <tr>
                        <td>
                            <img src="<%= element.image %>" alt="" width="50%" height="50%">

                        </td>
                        <td>
                            <%= element.name %>
                        </td>
                        <td>
                            <%= element.category %>
                        </td>
                        <td>
                            <%= element.description %>
                        </td>
                        <td>
                            <%= element.price %>
                        </td>
                        <td class="dt-center">
                            <button type="button" class="btn btn-sm btn-info edit-btn">
                                <i class="fas fa-edit"></i>
                                Edit
                            </button>
                            <button type="button" class="btn btn-sm btn-danger delete-btn">
                                <i class="fas fa-trash"></i>
                                Delete
                            </button>
                        </td>
                    </tr>
                    <% }); %>
            </tbody>
        </table>
    </div>
    <%- include('../inc/footer') %>

        <!-- Modal sửa sản phẩm -->
        <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel">Edit Product</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- Form sửa sản phẩm sẽ được load ở đây -->
                        <form class="row g-3">
                            <div class="col-12">
                                <label for="inputName" class="form-label">Name</label>
                                <input type="text" class="form-control" id="inputName">
                            </div>
                            <div class="col-md-6">
                                <label for="inputCategory" class="form-label">Category</label>
                                <select type="text" class="form-select" id="inputCategory">
                                    <option selected>Choose...</option>
                                    <option>...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="inputPrice" class="form-label">Price</label>
                                <input type="text" class="form-control" id="inputPrice">
                            </div>
                            <div class="col-12">
                                <label for="inputDescription" class="form-label">Description</label>
                                <textarea name="description" id="inputDescription" cols="60" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="image">Image</label>
                                <input type="file" name="image" class="form-control" id="image" required>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save Change</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal xóa sản phẩm -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Xóa sản phẩm</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure delete this product?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal nhập sản phẩm -->
        <div class="modal fade" id="addProductModal" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addProductModalLabel">Add Product</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- Form nhập thông tin sản phẩm mới -->
                        <form class="row g-3">
                            <div class="col-12">
                                <label for="inputName" class="form-label">Name</label>
                                <input type="text" class="form-control" id="inputName">
                            </div>
                            <div class="col-md-6">
                                <label for="inputCategory" class="form-label">Category</label>
                                <select type="text" class="form-select" id="inputCategory">
                                    <option selected>Choose...</option>
                                    <option>...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="inputPrice" class="form-label">Price</label>
                                <input type="text" class="form-control" id="inputPrice">
                            </div>
                            <div class="col-12">
                                <label for="inputDescription" class="form-label">Description</label>
                                <textarea name="description" id="inputDescription" cols="60" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="image">Image</label>
                                <input type="file" name="image" class="form-control" id="image" required>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Link các script của datatable và bootstrap -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.11.4/js/dataTables.bootstrap4.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>
        <!-- Script để load dữ liệu sản phẩm và xử lý sự kiện khi click vào nút sửa hoặc xóa -->
        <script>
            $(document).ready(function () {
                // Khởi tạo datatable
                var table = $('#productTable').DataTable({
                    // Cấu hình hiển thị của các cột
                    columnDefs: [
                        { "width": "10%", "targets": 0, "className": "text-center align-middle", "orderable": false },
                        { "targets": 1, "className": "text-center align-middle" },
                        { "targets": 2, "className": "text-center align-middle", "orderable": false },
                        { "targets": 3, "className": "text-center align-middle" },
                        { "targets": 4, "className": "text-center align-middle" },
                        { "width": "20%", "targets": 5, "className": "text-center align-middle", "orderable": false },
                    ],
                });

                // Thêm tính năng bộ lọc cột cho cột "group"
                table.columns(2).every(function () {
                    var column = this;
                    var select = $('#group-filter');

                    select.on('change', function () {
                        var val = $.fn.dataTable.util.escapeRegex(
                            $(this).val()
                        );

                        column.search(val ? '^' + val + '$' : '', true, false).draw();
                    });
                });

                // Xử lý sự kiện khi click vào nút sửa
                $('#productTable tbody').on('click', '.edit-btn', function () {
                    var data = table.row($(this).parents('tr')).data();
                    // Hiển thị modal sửa sản phẩm
                    $('#editModal').modal('show');
                    // Load dữ liệu sản phẩm vào form sửa sản phẩm
                    //$('#editModal .modal-body').html('<p>Bạn đang sửa sản phẩm ' + data.name + '</p>');
                });

                // Xửlý sự kiện khi click vào nút xóa
                $('#productTable tbody').on('click', '.delete-btn', function () {
                    var data = table.row($(this).parents('tr')).data();
                    // Hiển thị modal xóa sản phẩm
                    $('#deleteModal').modal('show');
                    // Load dữ liệu sản phẩm vào modal xóa sản phẩm
                    $('#deleteModal .modal-body').html('<p>Bạn có chắc muốn xóa sản phẩm ' + data.name + '?</p>');
                });

                // Bắt sự kiện click vào nút "Thêm sản phẩm"
                $('#addProductModal').on('show.bs.modal', function (event) {
                    // Xử lý khi modal được hiển thị
                });

                // Bắt sự kiện click vào nút "Lưu" trong modal
                $('#addProductModal .btn-primary').on('click', function (event) {
                    // Xử lý khi người dùng click vào nút "Lưu"
                });
            });
        </script>